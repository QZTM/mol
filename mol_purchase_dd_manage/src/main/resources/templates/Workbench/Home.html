<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<link rel="stylesheet" href="/layui/css/layui.css">
	<script src="/echarts.min.js"></script>
	<script src="http://libs.baidu.com/jquery/1.9.0/jquery.js" type="text/javascript"></script>

	<body onload="landing()"><!--width:1679px-->
		<div style="width:100%; height: 1000px;"><!--width: 1679px-->
			<div style="margin: 24px;"><!--日期-->
			 <a style="font-size: 22px;"><font size="3">日期：</font></a>
		     <select id="select" style="font-size: 12px;width: 120px; height: 26px;" onchange="select_change(this)">
              <option value ="quan" >本周</option>
              <option value ="saab">本月</option>
              <option value="opel">本年</option>
              <option value="audi">全部</option>
             </select>
             <hr class="layui-bg-green"><!--绿色的分割线-->
			</div>
			<div style="width: 100%;height: 1000px;"><!--width: 1679px-->
				<div style="width: 71.4%;height: 1000px; float:left;display:inline;"><!--width: 1200px-->
					<div style="width: 99.1%;height:400px ;border:1px solid #B2B2B2; margin: 10px;"><!--订单状态数量统计width: 1190px-->
						<div style="width: 350px;height: 100px;margin: 16px;background-color: #009F95;float: left;" ><!--各个订单类别-->
							<div style="float: left;display: inline;margin-right: 24px;">
								<img style="width: 100px;height: 100px;" src="/imge/timg.jpg"/>
							</div>
							<div style="width: 200px;height: 80px;float: left; display: inline;">
								<div style="width: 190px;margin-top: 16px;"><font size="4" color="#FBFBFB">进行中的采购订单</font></div><!--描述-->		
								<div  style="width: 190px;margin-top: 16px;margin-left: 24px;">
									<p id="barNumber1" style="color: #fbfbfb;font-size: 20px">..</p>
								</div><!--数量-->
							</div>
						</div>
						
						<div style="width: 350px;height: 100px;margin: 16px;background-color: #009F95;float: left;"><!--各个订单类别-->
							<div style="float: left;display: inline;margin-right: 24px;">
								<img style="width: 100px;height: 100px;" src="/imge/timg.jpg" />
							</div>
							<div style="width: 200px;height: 80px;float: left; display: inline;">
								<div style="width: 190px;margin-top: 16px;"><font size="4" color="#FBFBFB">已完成的采购订单</font></div><!--描述-->		
								<div  style="width: 190px;margin-top: 16px;margin-left: 24px;">
									<p id="barNumber2" style="color: #fbfbfb;font-size: 20px">..</p>
								</div><!--数量-->
							</div>
						</div>
						
						<div style="width: 350px;height: 100px;margin: 16px;background-color: #009F95;float: left;" ><!--各个订单类别-->
							<div style="float: left;display: inline;margin-right: 24px;">
								<img style="width: 100px;height: 100px;" src="/imge/timg.jpg" />
							</div>
							<div style="width: 200px;height: 80px;float: left; display: inline;">
								<div style="width: 190px;margin-top: 16px;"><font size="4" color="#FBFBFB">已废止的订单</font></div><!--描述-->		
								<div  style="width: 190px;margin-top: 16px;margin-left: 24px;">
									<p id="barNumber3" style="color: #fbfbfb;font-size: 20px">..</p>
								</div><!--数量-->
							</div>
						</div>
						
						<div style="width: 350px;height: 100px;margin: 16px;background-color: #009F95;float: left;"><!--各个订单类别-->
							<div style="float: left;display: inline;margin-right: 24px;">
								<img style="width: 100px;height: 100px;" src="/imge/timg.jpg" />
							</div>
							<div style="width: 200px;height: 80px;float: left; display: inline;">
								<div style="width: 190px;margin-top: 16px;"><font size="4" color="#FBFBFB">当前供应商数</font></div><!--描述-->		
								<div  style="width: 190px;margin-top: 16px;margin-left: 24px;">
									<p id="barNumber4" style="color: #fbfbfb;font-size: 20px">..</p>
								</div><!--数量-->
							</div>
						</div>
						
						<div style="width: 350px;height: 100px;margin: 16px;background-color: #009F95;float: left;"><!--各个订单类别-->
							<div style="float: left;display: inline;margin-right: 24px;">
								<img style="width: 100px;height: 100px;" src="/imge/timg.jpg" />
							</div>
							<div style="width: 200px;height: 80px;float: left; display: inline;">
								<div style="width: 190px;margin-top: 16px;"><font size="4" color="#FBFBFB">新增供应商数</font></div><!--描述-->		
								<div  style="width: 190px;margin-top: 16px;margin-left: 24px;">
									<p id="barNumber5"style="color: #fbfbfb;font-size: 20px">..</p>
								</div><!--数量-->
							</div>
						</div>
						
					</div>
					
					
					<div id="order" style="width: 99.1%; height: 500px ;border:1px solid #B2B2B2;margin: 10px;"><!--订单实时跟踪列表width: 1190px-->

						<div style="margin: 8px;">
							<div style="margin-left: 14px; padding: 4px;background-color: #01AAED;width: 170px; border-radius: 6px;color: #FBFBFB;">
							 <font onclick="add_Notice()" id="Order_item_0_font" size="4" style="margin-left: 12px;">采购订单实时跟踪</font>
							</div>
							<div id="Order_item_0" style="margin-top: 10px;overflow-y:auto;height: 430px;text-align: center">

							</div>
						</div>
					</div>
					
					<div style="width: 99.1%;height: 500px; border:1px solid #B2B2B2;margin: 10px;"><!--订单实时跟踪列表width: 1190px-->
					    <div  style="margin: 8px;">
					    	<div style="margin-left: 14px; padding: 4px;background-color: #01AAED;width: 220px; border-radius: 6px;color: #FBFBFB;">
					    		<font size="4" style="margin-left: 12px;" onclick="add_order()">供应商审核申请实时跟踪</font>
					    	</div>
							<div id="Notice" style="margin-top: 10px;overflow-y:auto;height: 430px;text-align: center">

							</div>

						</div>

					</div>
					
				</div>
				<div style="width: 23.8%;height: 1425px; border:1px solid #B2B2B2;float:left;display:inline;margin: 10px;"><!--内部公告width:400px-->
					<div id="announcement" style="float: left;margin: 18px;color: #FBFBFB;">
						<div style="width: 100.4%; height: 40px; background-color: #01AAED;border-radius: 12px;font-size: 28px;text-align: center;"><!--width: 360px-->
							<font>内部公告</font>
						</div>
						<!--<div style="width: 340px; height: auto; background-color:burlywood;border-radius: 12px; margin-top: 18px; padding: 10px;">
							<div style="height: auto;">
							  <div style=" color: #FBFBFB;font-size: 20px;">
								<font style="margin-top: 12px">
									2019年06月13日09:38
								</font>
							  </div>
							  <div  style="margin-top: 12px; color: #FBFBFB;font-size: 14px;word-break: break-all;word-wrap: break-word;">
								<font></font>
							  </div>
							</div>
					
						</div>-->
						
					</div>
					
				</div>
			</div>

			<div  style="width: 100%;height:1100px;margin-left: 10px"><!--统计图表--><!--width: 1679px-->
				<div style="width: 100%;float:left; display:inline;">
					<div>
						<a>单品历史价格</a>
					</div>
					<div style="width:100%;height: 420px;">
						<div id="history_money_title" style="border:1px solid #B2B2B2;display: inline-block;width: 15%;height:400px;margin: 3px"><!--单品采购历史价格width: 1600px-->
						</div>
						<div id="history_money_chart" style="border:1px solid #B2B2B2;display: inline-block;width: 60%;height:400px; margin: 3px"><!--单品采购历史价格width: 1600px-->
						</div>
						<div id="history_money_context" style="border:1px solid #B2B2B2;display: inline-block;width: 18%;height:400px;margin: 3px"><!--单品采购历史价格width: 1600px-->
						</div>
					</div>

				</div>
				<div style="width: 47%;float:left; margin-top: 10px;display:inline;border:1px solid #B2B2B2"><!--width:790px-->
					<div>
						<a>供应商基数统计图</a>
					</div>
					<div id="supplier_number" style="width: 100%;height:400px;"><!--供应商人数-->

					</div>
				</div>

				<div style="width: 47.6%;float:left; margin-left: 10px; margin-top: 10px;display:inline;border:1px solid #B2B2B2"><!--width: 800px-->
					<div>
						<a>采购金额统计</a>
					</div>
					<div id="supplier_money" style="width: 100%;height:400px;"><!--采购金额统计--><!--width: 800px-->
					</div>
				</div>
			</div>

		</div>
		<script src="/layui/layui.all.js"></script>

		
		<script>
			function landing()//psot后端数据
			{

				add_announcement();
				Update_chart();//更新切换数据表

				Get_purchase_infor(0);
				Get_real_time();//获取正在审核的采购订单
				Get_Supplier_review_real_time()//获取供应商审核进程
			}

			function select_change(e)//下拉选择的相应事件
			{
				var select=document.getElementById("select");
				Get_purchase_infor(select.selectedIndex);
			}

			
			function Get_purchase_infor(select_number)//刷新订单状态栏的基本信息
			{
				$.ajax({
					type:'POST',
					url:'/Purchase_infor/Purchase_bar_infor',
					dataType: 'json',
					 data:{number:select_number},
					// headers:{  'eticket': app.globalData.eticket},
					success:function (data) {
                     console.log(data.bar[0]);
                     for (var n=0;n<5;n++)
					 {
						 var bar_item=document.getElementById("barNumber"+(n+1).toString());
						 bar_item.innerText=data.bar[n]
					 }
					},
					error:function (data) {
						console.log(data);
						alert("失败")
					}
				});
			}
			function Get_real_time()//采购订单实时跟踪
			{
				$.ajax({
					type:'POST',
					url:'/Purchase_infor/Purchase_track',
					dataType: 'json',
				//	data:{number:select_number},
					// headers:{  'eticket': app.globalData.eticket},
					success:function (data) {
						console.log(data[2].create_time);
						add_order(data);//添加实时跟踪数据表
					},
					error:function (data) {
						alert("订单实时跟踪数据获取失败")
					}
				});
			}
			
			function  Get_Supplier_review_real_time()//获取供应商审核进程
			{
				$.ajax({
					type:'POST',
					url:'/Purchase_infor/Get_Supplier_Review',
					dataType: 'json',
					//	data:{number:select_number},
					// headers:{  'eticket': app.globalData.eticket},
					success:function (data) {
						add_supplier_review(data);//后台获取的数据添加到生成表视图
					},
					error:function (data) {
					/*	alert("获取供应商审核进程数据失败")*/
						var image=document.createElement("img");
						image.style.height="100%";
						image.style.width="60%";
						image.src="/imge/data_null.jpg"
						document.getElementById("Notice").appendChild(image);
					}
				});
			}

			function add_order(data)
			{
			 for (var i = 0; i < data.length; i++) {
				 var divitem = document.createElement("div");  
				 var div = document.getElementById("Order_item_0");  
                     divitem.innerHTML = 
                    
							'<div style="margin: 15px; width:92.4%;height: 120px; background-color: #009F95;border-radius:12px;">'+ //width: 1100px
								 ' <div style="float: left;margin-top: 12px;margin-left: 12px;"><font size="5" color="#FBFBFB">'+data[i].goods_name+'</font></div>'+
   							     ' <div style="width: 98.1%; float: left;margin-top: 6px;font-size: 15px;">'+//width: 1080px
								'	<font color="#FBFBFB" style="float: left;margin-left: 12px;" >编号: '+data[i].order_number+'采购类型:'+data[i].buy_channel_id+'</font>'+
								'	<font style="float:right;margin-right: 5px;" color="#FBFBFB" >详情</font>'+
								'	<font color="#FBFBFB" style="float:right;margin-right: 55px;">采购申请人:'+data[i].staff_id+'</font>'+
								 ' </div>'+
								'<div style="width: 98.1%; float: left;margin-top: 5px;text-align: center;color: #FBFBFB; font-size: 15px;">'+//width: 1080px
									'<div style="float: left;margin: 10px; width: 100px;height:26px;background-color: #01AAED; border-radius:6px;">'+
										'<font>'+data[i].goods_type+'</font>'+
									'</div>'+
									'<div style="float: left;margin: 10px; width: 100px;height:26px;background-color: #EB7350;border-radius:6px;">'+
										'<font>正在进行</font>'+
									'</div>'+
									'<div>'+
										'<font style="float:right;margin-right: 5px;"  color="#FBFBFB" >申请时间:'+data[i].create_time+'</font>'+
									'</div>'+
								'</div>'+
							'</div>'
	                           div.appendChild(divitem);                                              
                               }
			}

			function add_supplier_review(data)
			{
				if (data.length<1)
				{
					var image=document.createElement("img");
					image.style.height="100%";
					image.style.width="60%";
					image.src="/imge/data_null.jpg"
					document.getElementById("Notice").appendChild(image);
				}
				else
				{
					for (var i = 0; i < data.length; i++) {
						var divitem = document.createElement("div");
						var div = document.getElementById("Notice");
						divitem.innerHTML =
								'<div style="margin: 15px; width:92.4%;height: 90px; background-color: #009F95;border-radius:12px;">'+
								'<div style="width: 98.1%;float: left;margin-top: 12px;margin-left: 12px;">'+
								'<font size="5" color="#FBFBFB">'+data[i].name+'</font>'+
								'<font style="float:right;margin-right: 15px;font-size: 20px;" color="#FBFBFB" >开始审核</font>'+
								'</div>'+
								' <div style="width: 98.1%; float: left;margin-top: 6px;font-size: 15px;">'+
								'<font  color="#FBFBFB" style="float: left;margin-left: 12px;" >申请类型：'+data[i].supplier_attr+'</font>'+
								'<font  style="float:right;margin-right: 5px;"  color="#FBFBFB" >申请时间:'+data[i].regist_time+'</font>'+
								'</div>'+
								'</div>';
						div.appendChild(divitem);
					}
				}
			}
			
			function add_announcement()
			{
									var a=[{"itme1":"山东XX有限公司","itme2":"询价采购","itme3":"开始审批","itme4":"2019年06月12日 09:34"},
				{"itme1":"山东XX有限公司","itme2":"询价采购","itme3":"开始审批","itme4":"2019年06月12日 09:34"}];
				
				 for (var i = 0; i < 6; i++) { 
				 var divitem = document.createElement("div");  
				 var div = document.getElementById("announcement");  
                     divitem.innerHTML = 
						'<div style="width: 95%; height: auto; background-color:burlywood;border-radius: 12px; margin-top: 18px; padding: 10px;">'+
							'<div style="height: auto;">'+
							  '<div style=" color: #FBFBFB;font-size: 20px;">'+
								'<font style="margin-top: 12px">'+
									'2019年06月13日09:'+
								'</font>'+
							  '</div>'+
							  '<div  style="margin-top: 12px; color: #FBFBFB;font-size: 14px;word-break: break-all;word-wrap: break-word;">'+
								'<font>111111111111111ddddddddddddddd111111111111111111qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq111111111111</font>'+
							  '</div>'+
							'</div>'+
						'</div>'
	                           div.appendChild(divitem);                                              
                               } 
			}


			function Update_chart()
			{
				var i=0;
				var History_price1=[2.0, 4.9, 7.0, 23.2, 25000.6, 76.7, 6000.6, 162.2, 32.6, 6000, 6.4, 33];//历史价格
				var History_price2=[2000, 409, 70, 23.2, 2500.6, 7600.7, 1350.6, 162.2, 32.6, 4000.0, 6.4, 330];//历史价格
				var History_price3=[20000, 489, 100, 232, 15000.6, 76.7, 9000.6, 162.2, 32.6, 2000.0, 6.4, 3400];//历史价格
				var History_prices=new Array();
				History_prices[0]=History_price1;
				History_prices[1]=History_price2;
				History_prices[2]=History_price3;
				var Average_price;//平均价格

               setInterval(function () {
                    if (i<History_prices.length)
					{
						var myChart_0 = echarts.init(document.getElementById('history_money_chart'));

						var option_0= {
							tooltip: {
								trigger: 'axis',
								axisPointer: {
									type: 'cross',
									crossStyle: {
										color: '#999'
									}
								}
							},
							toolbox: {
								feature: {
									dataView: {show: true, readOnly: false},
									magicType: {show: true, type: ['line', 'bar']},
									restore: {show: true},
									saveAsImage: {show: true}
								}
							},
							legend: {
								data:['单月价格','平均价格']
							},
							xAxis: [
								{
									type: 'category',
									data: ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月'],
									axisPointer: {
										type: 'shadow'
									}
								}
							],
							yAxis: [
								{
									type: 'value',
									name: '单月价格',
									min: 0,
									// max: 250,
									interval: 20000,
									axisLabel: {
										formatter: '{value} 元'
									}
								},
								{
									type: 'value',
									name: '平均价格',
									min: 0,
									//  max: 25,
									interval: 20000,
									axisLabel: {
										formatter: '{value}元'
									}
								}
							],
							series: [
								{
									name:'单月价格',
									type:'bar',
									data:History_prices[i]
								},

								{
									name:'平均价格',
									type:'line',
									yAxisIndex: 1,
									data:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2]
								}
							]
						};
						myChart_0.setOption(option_0)
						i++;
					}
                    else
					{
						i=0;
					}

			   },3000);
			}




		</script>

		<script type="text/javascript">
			// 基于准备好的dom，初始化echarts实例

			var myChart = echarts.init(document.getElementById('supplier_number'));
			var supplier_money = echarts.init(document.getElementById('supplier_money'));


			// 指定图表的配置项和数据
			var option = {
				xAxis: {
					type: 'category',
					boundaryGap: false,
					data: ['1月','1月','1月','1月','1月','1月','2月', '3月', '4月', '5月', '6月', '7月', '本月']
				},
				yAxis: {
					type: 'value'
				},
				series: [{
					data: [11,222,333,444,555,666,820, 932, 901, 934, 1290, 1330, 1320],
					type: 'line',
					areaStyle: {}
				}]
			};



			var option_1= {
				legend: {},
				tooltip: {},
				dataset: {
					source: [
						['product', '产品类', '设备类', '配件类','材料类','酒店类','应税劳务'],
						['9月份', 99, 85.8, 93.7,11,213,234],
						// ['Milk Tea', 83.1, 73.4, 55.1],
						// ['Cheese Cocoa', 86.4, 65.2, 82.5],
						// ['Walnut Brownie', 72.4, 53.9, 39.1]
					]
				},
				xAxis: {type: 'category'},
				yAxis: {},
				// Declare several bar series, each will be mapped
				// to a column of dataset.source by default.
				series: [
					{type: 'bar'},
					{type: 'bar'},
					{type: 'bar'},
					{type: 'bar'},
					{type: 'bar'},
					{type: 'bar'}
				]
			};

			// 使用刚指定的配置项和数据显示图表。

			myChart.setOption(option);
			supplier_money.setOption(option_1);
		</script>
		
	</body>
</html>
